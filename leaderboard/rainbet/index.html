<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rainbet Leaderboard | R2K2</title>
  <link rel="stylesheet" href="/css/lb.css">
  <link rel="stylesheet" href="/css/app.css">
  <script defer src="/js/particles.js"></script>
  <script defer src="/js/countdown-roobet.js"></script>
</head>

<body>
  <header>
    <h1>Rainbet Leaderboard (R2K2)</h1>
    <p class="subtitle">Every bet under code <strong>R2K2</strong> counts toward the monthly rewards!</p>
  </header>

  <section class="countdown">
    <div>Ending in: <span id="countdown">Loading...</span></div>
  </section>

  <section class="leaderboard">
    <div id="top3-cards" class="top-three"></div>
    <div id="leaderboard-rows" class="leaderboard-list"></div>
  </section>

  <script>
    const API_URL = 'https://services.rainbet.com/v1/external/affiliates?start_at=2025-08-18&end_at=2025-09-19&key=xxx';
    const rewards = [100, 200, 50, 20, 15, 10, 5];
    const top3Glows = ['0 0 40px #C0C0C0', '0 0 40px #FFD700', '0 0 40px #CD7F32'];

    function maskUsername(username) {
      if (!username) return 'Unknown';
      if (username.length <= 4) return username;
      return username.slice(0, 2) + '***' + username.slice(-2);
    }

    async function loadLeaderboard() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        const data = json.affiliates || [];

        const sorted = data
          .filter(user => parseFloat(user.wagered_amount) > 0)
          .sort((a, b) => parseFloat(b.wagered_amount) - parseFloat(a.wagered_amount));

        const top10 = sorted.slice(0, 10);

        const top3Container = document.getElementById("top3-cards");
        const rowsContainer = document.getElementById("leaderboard-rows");
        top3Container.innerHTML = '';
        rowsContainer.innerHTML = '';

        top10.forEach((entry, index) => {
          const place = index + 1;
          const reward = index < rewards.length ? `$${rewards[index]}` : '$0';
          const wagered = `$${parseFloat(entry.wagered_amount).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
          const username = maskUsername(entry.username);

          if (index < 3) {
            const card = document.createElement('div');
            card.className = 'top-card';
            card.style.boxShadow = top3Glows[index];
            card.innerHTML = `
              <div class="username">${username}</div>
              <div class="amount">${wagered}</div>
              <div class="reward">${reward}</div>
            `;
            top3Container.appendChild(card);
          } else {
            const row = document.createElement('div');
            row.className = 'leaderboard-row';
            row.innerHTML = `
              <div class="rank">#${place}</div>
              <div class="username">${username}</div>
              <div class="wagered">${wagered}</div>
              <div class="reward">${reward}</div>
            `;
            rowsContainer.appendChild(row);
          }
        });
      } catch (error) {
        console.error('Leaderboard error:', error);
        document.getElementById("leaderboard-rows").innerText = "Error loading leaderboard.";
      }
    }

    function updateCountdown() {
      const el = document.getElementById("countdown");
      const now = new Date();
      const target = new Date("2025-08-22T23:59:59Z");
      const diff = target - now;

      if (diff <= 0) {
        el.textContent = "Ended";
        return;
      }

      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const m = Math.floor((diff / (1000 * 60)) % 60);
      const s = Math.floor((diff / 1000) % 60);

      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
    loadLeaderboard();
  </script>
</body>

</html>
