<!DOCTYPE html>
<html lang="en">

<head>
  <title>R2K2 | Rainbet Leaderboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Exclusive wager races on Rainbet for code R2K2!">
  <meta property="og:image" content="/assets/logo.png">
  <link rel="icon" type="image/jpg" href="/assets/logo.png">
  <link rel="stylesheet" type="text/css" href="/css/app.css">
  <link rel="stylesheet" type="text/css" href="/css/lb.css">
  <link rel="stylesheet" type="text/css" href="/css/vendor.css">
  <script src="/js/countdown-roobet.js"></script>
  <link rel="stylesheet" type="text/css" href="/css/toast.css">
  <!-- include your modal, styles, and leaderboard content here (unchanged from your version) -->
</head>

<body>
  <!-- your modal, header, navigation, and leaderboard layout here (unchanged) -->

  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"93f624c93c488202","version":"2025.4.0-1-g37f21b1","r":1,"token":"6a289e34095c4e319f5a765107c772ad","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}}}' crossorigin="anonymous"></script>

  <script>
    var modal = document.getElementById("rulesModal");
    var btn = document.getElementById("rulesButton");
    var span = document.getElementsByClassName("close")[0];

    btn.onclick = function () {
      modal.style.display = "block";
      document.body.style.overflow = "hidden";
      setTimeout(() => {
        modal.classList.add("show");
      }, 10);
    }

    span.onclick = closeModal;

    window.onclick = function (event) {
      if (event.target == modal) {
        closeModal();
      }
    }

    function closeModal() {
      modal.classList.remove("show");
      setTimeout(() => {
        modal.style.display = "none";
        document.body.style.overflow = "auto";
      }, 500);
    }
  </script>

  <script src="/js/app.js"></script>
  <script src="/js/particles.js"></script>
  <script src="/js/toast.js"></script>
  <script>
    const CURRENT_API_URL = 'https://services.rainbet.com/v1/external/affiliates?start_at=2025-07-23&end_at=2025-08-22&key=OjwJ62YWj7gveE0OkmkrCvRM4U3Omh16';
    const rainbetLogo = '/assets/rainbetlogo.png';
    const rewards = [100, 200, 50, 20, 15, 10, 5];
    const top3Glows = ['0 0 40px #C0C0C0', '0 0 40px #FFD700', '0 0 40px #CD7F32'];

    function updateCountdown() {
      const el = document.getElementById("countdown");
      const now = new Date();
      const jstNow = new Date(now.getTime() + 9 * 60 * 60 * 1000);
      const year = jstNow.getUTCFullYear();
      const month = jstNow.getUTCMonth();
      const endTargetJST = new Date(Date.UTC(year, month, 22, 14, 59, 59));
      const diff = endTargetJST - now;
      if (diff <= 0) return el.textContent = "Ended";
      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const m = Math.floor((diff / (1000 * 60)) % 60);
      const s = Math.floor((diff / 1000) % 60);
      el.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();

    function maskUsername(username) {
      if (!username) return 'Unknown';
      if (username.length <= 4) return username;
      return username.slice(0, 2) + "***" + username.slice(-2);
    }

    async function loadLeaderboard(apiURL = CURRENT_API_URL) {
      try {
        const res = await fetch(apiURL);
        const json = await res.json();
        const data = json.affiliates || [];

        const sorted = data
          .filter(user => parseFloat(user.wagered_amount) > 0)
          .sort((a, b) => parseFloat(b.wagered_amount) - parseFloat(a.wagered_amount));

        const top10 = sorted.slice(0, 10);

        const top3Container = document.querySelector(".css-gqrafh");
        const rowsContainer = document.getElementById("leaderboard-rows");
        top3Container.innerHTML = '';
        rowsContainer.innerHTML = '';

        top10.forEach((entry, index) => {
          const place = index + 1;
          const reward = index < rewards.length ? `$ ${rewards[index]}` : '$ 0';
          const wagered = `$ ${parseFloat(entry.wagered_amount).toLocaleString(undefined, {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          })}`;
          const username = maskUsername(entry.username);

          if (index < 3) {
            const card = document.createElement('div');
            card.className = 'css-jehefp';
            card.style.boxShadow = top3Glows[index];
            card.style.position = 'relative';
            if (index === 1) card.style.transform = 'translateY(25px) scale(1.2)';
            if (index === 2) card.style.transform = 'translateY(25px)';
            card.innerHTML = `
              <img src="${rainbetLogo}" style="width: 96px; height: auto; border-radius: 12px;">
              <div class="css-hca0vm"><span class="css-15a1lq3" style="font-weight:bold;">${username}</span></div>
              <div class="css-7ahevu ejrykqo0"><span class="css-1vqddgv">Wagered: </span>
                <span class="css-18icuxn"><div class="css-1y0ox2o"><span class="css-114dvlx">${wagered}</span></div></span>
              </div>
              <span class="css-v4675v"><div class="css-1y0ox2o"><span class="css-114dvlx glow">${reward}</span></div></span>
            `;
            top3Container.appendChild(card);
          } else {
            const row = document.createElement('div');
            row.className = 'row list row-cols-5';
            row.setAttribute('data-v-1d580398', '');
            row.innerHTML = `
              <div class="hide-mobile col-2"><b style="font-size: 18px;">#${place}</b></div>
              <div class="col-5">
                <img src="${rainbetLogo}" width="22" style="margin-right: 8px;">
                <span style="font-weight:bold; font-size: 16px;">${username}</span>
              </div>
              <div class="col-2">
                <div class="price-wrapper glow" style="font-weight:bold; font-size: 15px;">${reward}</div>
              </div>
              <div class="col-3">
                <div class="price-wrapper" style="color: #FFF; font-weight:bold; font-size: 15px;">${wagered}</div>
              </div>
            `;
            const wrapper = document.createElement("div");
            wrapper.className = "leaderboard-row-wrapper";
            wrapper.appendChild(row);
            rowsContainer.appendChild(wrapper);
          }
        });
      } catch (err) {
        console.error("[‚ùå] Failed to load leaderboard:", err.message);
        document.getElementById("leaderboard-rows").innerHTML = "<p style='color:red;'>Failed to load data.</p>";
      }
    }

    loadLeaderboard();
  </script>
</body>
</html>
